<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Men√π AR Pub</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
body {
  margin:0;
  background:#0b0b0b;
  color:white;
  font-family:system-ui;
}

/* START BUTTON */
#start {
  position:fixed;
  inset:0;
  background:#000;
  z-index:100;
  display:flex;
  align-items:center;
  justify-content:center;
}

#start button {
  font-size:26px;
  padding:20px 50px;
  border-radius:40px;
  border:none;
  background:linear-gradient(145deg,#ffb347,#ff7e00);
  cursor:pointer;
}

/* HEADER */
header img {
  width:100%;
  height:180px;
  object-fit:cover;
  display:block;
}

/* MENU */
.menu {
  display:flex;
  height:calc(100vh - 180px);
  padding:6px;
  gap:8px;
}

.column {
  flex:1;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* COLORI COLONNE */
.column.panini { background:linear-gradient(180deg,#3a2a00,#161100); }
.column.piadine { background:linear-gradient(180deg,#3a1900,#160a00); }
.column.hamburger { background:linear-gradient(180deg,#3a0000,#160000); }

.column h2 {
  text-align:center;
  margin:10px;
  padding:10px;
  background:rgba(255,255,255,0.1);
  border-radius:12px;
}

/* SCROLLER */
.list {
  flex:1;
  overflow-y:scroll;
  position:relative;
  -webkit-overflow-scrolling: touch;
}

/* LINEA CENTRALE INVISIBILE */
.list::after {
  content:"";
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:2px;
  transform:translateY(-1px);
  pointer-events:none;
}

.item {
  margin:14px;
  padding:18px;
  background:linear-gradient(145deg,#2e2e2e,#161616);
  border-radius:14px;
  text-align:center;
  cursor:pointer;
  font-size:18px;
}

model-viewer { display:none; }
</style>
</head>

<body>

<!-- START -->
<div id="start">
  <button onclick="enter()">ENTRA</button>
</div>

<!-- AUDIO -->
<audio id="scrollSound" src="sounds/scroll.mp3"></audio>
<audio id="clickSound" src="sounds/sparo.mp3"></audio>
<audio id="exitSound" src="sounds/ricarica.mp3"></audio>

<!-- HEADER -->
<header>
  <img src="images/intestazione.jpg">
</header>

<!-- MENU -->
<div class="menu">

  <div class="column panini">
    <h2>PANINI</h2>
    <div class="list" onscroll="checkCenter(this)">
      <div class="item" onclick="openAR()">Classico</div>
      <div class="item" onclick="openAR()">BBQ</div>
      <div class="item" onclick="openAR()">Texas</div>
      <div class="item" onclick="openAR()">Affumicato</div>
      <div class="item" onclick="openAR()">Piccante</div>
      <div class="item" onclick="openAR()">Crispy</div>
      <div class="item" onclick="openAR()">Veg</div>
      <div class="item" onclick="openAR()">Monster</div>
      <div class="item" onclick="openAR()">Extreme</div>
      <div class="item" onclick="openAR()">Double</div>
    </div>
  </div>

  <div class="column piadine">
    <h2>PIADINE</h2>
    <div class="list" onscroll="checkCenter(this)">
      <div class="item" onclick="openAR()">Crudo</div>
      <div class="item" onclick="openAR()">Porchetta</div>
      <div class="item" onclick="openAR()">Vegetale</div>
      <div class="item" onclick="openAR()">Formaggi</div>
      <div class="item" onclick="openAR()">Speck</div>
      <div class="item" onclick="openAR()">Bresaola</div>
      <div class="item" onclick="openAR()">Special</div>
    </div>
  </div>

  <div class="column hamburger">
    <h2>HAMBURGER</h2>
    <div class="list" onscroll="checkCenter(this)">
      <div class="item" onclick="openAR()">Cheese</div>
      <div class="item" onclick="openAR()">Doppio</div>
      <div class="item" onclick="openAR()">Triplo</div>
      <div class="item" onclick="openAR()">Bacon</div>
      <div class="item" onclick="openAR()">BBQ</div>
      <div class="item" onclick="openAR()">Smoked</div>
      <div class="item" onclick="openAR()">Monster</div>
    </div>
  </div>

</div>

<!-- MODELLO AR -->
<model-viewer
  id="ar"
  src="models/panino.glb"
  ar
  ar-modes="scene-viewer quick-look">
</model-viewer>

<script>
let audioUnlocked = false;
const lastIndex = new WeakMap();

function enter() {
  audioUnlocked = true;
  const s=document.getElementById("scrollSound"); s.play(); s.pause();
  document.getElementById("start").style.display="none";

  // Slot-machine effect iniziale
  document.querySelectorAll(".list").forEach(list=>{
    let direction = Math.random()>0.5?1:-1;
    let speed = Math.random()*2 + 1;
    let maxScroll = list.scrollHeight - list.clientHeight;
    let pos = Math.random()*maxScroll;
    list.scrollTop = pos;

    let interval = setInterval(()=>{
      if(!audioUnlocked) { clearInterval(interval); return; }
      pos += speed*direction;
      if(pos<0 || pos>maxScroll) direction*=-1;
      list.scrollTop = pos;
    },30);
  });
}

// Tic centrale con vibrazione
function checkCenter(list) {
  if (!audioUnlocked) return;

  const items = list.querySelectorAll(".item");
  const center = list.scrollTop + list.clientHeight / 2;

  items.forEach((item,i)=>{
    const itemCenter = item.offsetTop + item.offsetHeight/2;
    if(Math.abs(itemCenter - center) < 5){
      if(lastIndex.get(list)!==i){
        lastIndex.set(list,i);
        const s = document.getElementById("scrollSound");
        s.currentTime=0; s.play();
        if(navigator.vibrate) navigator.vibrate(10);
      }
    }
  });
}

// AR e suoni
function openAR() {
  document.getElementById("clickSound").play();
  const ar = document.getElementById("ar");
  ar.activateAR();

  ar.addEventListener("ar-status", e=>{
    if(e.detail.status==="not-presenting"){
      document.getElementById("exitSound").play();
    }
  },{once:true});
}
</script>

</body>
</html>
